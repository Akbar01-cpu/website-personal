<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Login + Absensi Kamera</title>

  <!-- STYLE -->
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <div class="topbar">
    <div>
      <h1 style="margin:0">Sistem Absensi</h1>
      <small>Absensi Kamera + Google Sheets</small>
    </div>
    <div class="flex">
      <button class="toggle small" id="darkToggle">Mode Gelap</button>
      <button class="small" id="btnQR">Login QR</button>
      <button class="small" id="btnAdmin">Admin</button>
    </div>
  </div>

  <!-- LOGIN -->
  <div class="card" id="loginCard">
    <h2>Login Absensi</h2>
    <input type="text" id="loginNama" placeholder="Masukkan nama Anda" />
    <button id="btnLogin">Login</button>
    <p id="loginStatus"></p>
  </div>

  <!-- ABSENSI -->
  <div class="card" id="absensiCard">
    <h2>Absensi Kamera</h2>
    <p><b>Nama:</b> <span id="showNama"></span></p>
    <p><b>Lokasi:</b> <span id="showLocation">-</span></p>
    <video id="video" autoplay muted playsinline></video>
    <button id="btnAmbilFoto">Ambil Foto</button>
    <canvas id="canvas" style="display:none;"></canvas>
    <div class="flex">
      <button id="btnKirim">Kirim Absensi</button>
      <button id="btnBukaKamera" class="small">Buka Kamera</button>
      <button id="btnStopAutoSave" class="small" style="background:#e84118">Stop Auto-Save</button>
    </div>
    <p id="status"></p>
  </div>

  <!-- DASHBOARD -->
  <div class="card" id="dashboardCard" style="display:none; margin-top:20px;">
    <h2>Dashboard Absensi</h2>
    <p><b>Waktu Sekarang:</b> <span id="liveClock"></span></p>
    <p><b>Status Absensi:</b> <span id="absenStatus"></span></p>
    <div style="display:flex;gap:10px;align-items:center">
      <div style="flex:1">
        <h3>Rekap Mingguan</h3>
        <canvas id="chart"></canvas>
      </div>
      <div style="width:240px">
        <h4>Ringkasan</h4>
        <p>Hadir: <span id="rekapHadir">0</span></p>
        <p>Terlambat: <span id="rekapTelat">0</span></p>
        <p>Tidak Absen: <span id="rekapTidak">0</span></p>
        <button id="btnRefreshRekap">Refresh Rekap</button>
      </div>
    </div>
  </div>

  <!-- QR LOGIN -->
  <div class="card" id="qrCard" style="display:none; margin-top:20px;">
    <h3>Login via QR Code</h3>
    <div id="reader" style="width:100%;"></div>
    <button id="btnStopQR">Stop QR Scan</button>
  </div>

  <!-- ADMIN -->
  <div class="card" id="adminCard" style="display:none; margin-top:20px;">
    <h2>Admin Panel</h2>
    <div id="adminLoginArea">
      <input type="password" id="adminPassword" placeholder="Masukkan password admin" />
      <button id="btnAdminLogin">Masuk sebagai Admin</button>
      <p id="adminLoginStatus"></p>
    </div>

    <div id="adminArea" class="hidden">
      <div style="display:flex;gap:10px">
        <input type="date" id="filterFrom" />
        <input type="date" id="filterTo" />
        <button id="btnFilterAdmin">Filter</button>
        <button id="btnDownloadCSV">Download CSV</button>
      </div>
      <div id="adminTableWrap" style="overflow:auto;max-height:400px;margin-top:10px">
        <table id="adminTable">
          <thead>
            <tr><th>No</th><th>Nama</th><th>Waktu</th><th>Foto</th></tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </div>

  <div class="confetti" id="confettiHolder"></div>

  <script src="https://unpkg.com/html5-qrcode"></script>
  <script src="app.js"></script>
</body>
</html>
